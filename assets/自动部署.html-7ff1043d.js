import{_ as n,o as s,c as a,d as p}from"./app-ac465cee.js";const t="/vuepress-lingdu-v2/assets/img-7bd8ee2d.png",e="/vuepress-lingdu-v2/assets/img_1-2d4260ac.png",o="/vuepress-lingdu-v2/assets/img_2-deadbbdd.png",c="/vuepress-lingdu-v2/assets/img_3-48d07970.png",i="/vuepress-lingdu-v2/assets/img_4-c561090e.png",l={},u=p(`<h1 id="vue自动部署" tabindex="-1"><a class="header-anchor" href="#vue自动部署" aria-hidden="true">#</a> vue自动部署</h1><h2 id="_1-用到的依赖" tabindex="-1"><a class="header-anchor" href="#_1-用到的依赖" aria-hidden="true">#</a> 1.用到的依赖</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> scp2 --save-dev 
<span class="token function">npm</span> <span class="token function">install</span> chalk --save-dev 
<span class="token function">npm</span> <span class="token function">install</span> ssh2 --save-dev 
<span class="token function">npm</span> <span class="token function">install</span> cross-env --save-dev 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-在vue项目根目录新建upload-server-js文件" tabindex="-1"><a class="header-anchor" href="#_2-在vue项目根目录新建upload-server-js文件" aria-hidden="true">#</a> 2.在vue项目根目录新建upload.server.js文件</h2><p><code>upload.server.js</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 服务器配置信息</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;192.168.0.230&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 服务器ip</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">&#39;22&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 端口一般默认22</span>
  <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 用户名</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">&#39;12345&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 密码</span>
  <span class="token literal-property property">pathNmae</span><span class="token operator">:</span> <span class="token string">&#39;一般就是打包后的文件夹名&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 上传到服务器的位置</span>
  <span class="token literal-property property">locaPath</span><span class="token operator">:</span><span class="token string">&#39;./本地打包后的文件夹名/&#39;</span> <span class="token comment">// 本地打包文件的位置</span>
<span class="token punctuation">}</span>
<span class="token comment">// 服务器文件根路径 服务器nginx 项目存放路径</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token string">&#39;/data/nginx/&#39;</span><span class="token punctuation">;</span>


<span class="token comment">// 引入scp2</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;scp2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;ora&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> spinner <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token string">&#39;正在发布到服务器...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Client <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;ssh2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Client<span class="token punctuation">;</span> <span class="token comment">// 创建shell脚本</span>
<span class="token keyword">const</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;正在建立连接&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
conn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;ready&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;已连接&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>server<span class="token punctuation">.</span>pathNmae<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;连接已关闭&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conn<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 这里我拼接了放置服务器资源目录的位置 ，首选通过rm -rf删除了这个目录下的文件</span>
  conn<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&#39;rm -rf &#39;</span> <span class="token operator">+</span> path <span class="token operator">+</span> server<span class="token punctuation">.</span>pathNmae <span class="token operator">+</span> <span class="token string">&#39;/*&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;删除文件&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> signal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;开始上传&#39;</span><span class="token punctuation">)</span>
      spinner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      client<span class="token punctuation">.</span><span class="token function">scp</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>locaPath<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;host&quot;</span><span class="token operator">:</span> server<span class="token punctuation">.</span>host<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;port&quot;</span><span class="token operator">:</span> server<span class="token punctuation">.</span>port<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span> server<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;password&quot;</span><span class="token operator">:</span> server<span class="token punctuation">.</span>password<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;path&quot;</span><span class="token operator">:</span> path <span class="token operator">+</span> server<span class="token punctuation">.</span>pathNmae
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        spinner<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;项目发布完毕&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;err&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        conn<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 结束命令</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 补充</span>
      <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;STDOUT: &#39;</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;STDERR: &#39;</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">host</span><span class="token operator">:</span> server<span class="token punctuation">.</span>host<span class="token punctuation">,</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> server<span class="token punctuation">.</span>port<span class="token punctuation">,</span>
  <span class="token literal-property property">username</span><span class="token operator">:</span> server<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> server<span class="token punctuation">.</span>password
  <span class="token comment">//privateKey: &#39;&#39; //使用 私钥密钥登录 目前测试服务器不需要用到</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-在package-json中-scripts-节点新加执行方法" tabindex="-1"><a class="header-anchor" href="#_3-在package-json中-scripts-节点新加执行方法" aria-hidden="true">#</a> 3.在package.json中&quot;scripts&quot;节点新加执行方法</h2><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 原有的测试、打包、等</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service serve&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:stage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service build --mode staging&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;preview&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node build/index.js --preview&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext .js,.vue src&quot;</span><span class="token punctuation">,</span>



	<span class="token comment">// 补充的 </span>
    <span class="token property">&quot;upload&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node upload.server.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 上传</span>
    <span class="token property">&quot;publish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run build:prod &amp;&amp; npm run upload&quot;</span> <span class="token comment">// 打包并上传到服务器</span>
  <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="演示" tabindex="-1"><a class="header-anchor" href="#演示" aria-hidden="true">#</a> 演示</h2><figure><img src="`+t+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="执行之前" tabindex="-1"><a class="header-anchor" href="#执行之前" aria-hidden="true">#</a> 执行之前</h2><figure><img src="'+e+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="执行" tabindex="-1"><a class="header-anchor" href="#执行" aria-hidden="true">#</a> 执行</h2><figure><img src="'+o+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="'+c+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="执行后" tabindex="-1"><a class="header-anchor" href="#执行后" aria-hidden="true">#</a> 执行后</h2><figure><img src="'+i+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',17),r=[u];function k(d,v){return s(),a("div",null,r)}const b=n(l,[["render",k],["__file","自动部署.html.vue"]]);export{b as default};
