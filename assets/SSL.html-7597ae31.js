import{_ as a,o as s,c as n,d as e}from"./app-ac465cee.js";const t={},p=e(`<h1 id="开启安全认证" tabindex="-1"><a class="header-anchor" href="#开启安全认证" aria-hidden="true">#</a> 开启安全认证</h1><h2 id="脚本" tabindex="-1"><a class="header-anchor" href="#脚本" aria-hidden="true">#</a> 脚本</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>
<span class="token comment">#!/bin/bash</span>
<span class="token comment">################################## 设置环境变量 ##############################</span>
<span class="token assign-left variable">BASE_DIR</span><span class="token operator">=</span>/opt/module/kafka_2.12-3.0.1 <span class="token comment"># SSL各种生成文件的基础路径</span>
<span class="token assign-left variable">CERT_OUTPUT_PATH</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$BASE_DIR</span>/diriver&quot;</span> <span class="token comment"># 证书文件生成路径</span>
<span class="token assign-left variable">PASSWORD</span><span class="token operator">=</span>kafkasslpwd <span class="token comment"># 密码</span>
<span class="token assign-left variable">KEY_STORE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$CERT_OUTPUT_PATH</span>/kafka.keystore&quot;</span>   <span class="token comment"># Kafka keystore文件路径</span>
<span class="token assign-left variable">TRUST_STORE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$CERT_OUTPUT_PATH</span>/kafka.truststore&quot;</span> <span class="token comment"># Kafka truststore文件路径</span>
<span class="token assign-left variable">KEY_PASSWORD</span><span class="token operator">=</span><span class="token variable">$PASSWORD</span> <span class="token comment"># keystore的key密码</span>
<span class="token assign-left variable">STORE_PASSWORD</span><span class="token operator">=</span><span class="token variable">$PASSWORD</span> <span class="token comment"># keystore的store密码</span>
<span class="token assign-left variable">TRUST_KEY_PASSWORD</span><span class="token operator">=</span><span class="token variable">$PASSWORD</span>  <span class="token comment"># truststore的key密码</span>
<span class="token assign-left variable">TRUST_STORE_PASSWORD</span><span class="token operator">=</span><span class="token variable">$PASSWORD</span> <span class="token comment"># truststore的store密码</span>
<span class="token assign-left variable">CLUSTER_NAME</span><span class="token operator">=</span>kafka-cluster   <span class="token comment"># 指定别名</span>
<span class="token assign-left variable">CERT_AUTH_FILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$CERT_OUTPUT_PATH</span>/ca-cert&quot;</span> <span class="token comment"># CA证书文件路径</span>
<span class="token assign-left variable">CLUSTER_CERT_FILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$CERT_OUTPUT_PATH</span>/<span class="token variable">\${CLUSTER_NAME}</span>-cert&quot;</span> <span class="token comment"># 集群证书文件路径</span>
<span class="token assign-left variable">DAYS_VALID</span><span class="token operator">=</span><span class="token number">365</span> <span class="token comment"># key有效期</span>
<span class="token comment">##############################################################################</span>


keytool <span class="token parameter variable">-keystore</span> <span class="token variable">$KEY_STORE</span> <span class="token parameter variable">-alias</span> <span class="token variable">$CLUSTER_NAME</span> <span class="token parameter variable">-validity</span> <span class="token variable">$DAYS_VALID</span> <span class="token parameter variable">-genkey</span> <span class="token parameter variable">-keyalg</span> RSA <span class="token parameter variable">-storepass</span> <span class="token variable">$STORE_PASSWORD</span> <span class="token parameter variable">-keypass</span> <span class="token variable">$KEY_PASSWORD</span>


<span class="token builtin class-name">echo</span> <span class="token string">&quot;2. 创建CA......&quot;</span>
openssl req <span class="token parameter variable">-new</span> <span class="token parameter variable">-x509</span> <span class="token parameter variable">-keyout</span> <span class="token variable">$CERT_OUTPUT_PATH</span>/ca-key <span class="token parameter variable">-out</span> <span class="token string">&quot;<span class="token variable">$CERT_AUTH_FILE</span>&quot;</span> <span class="token parameter variable">-days</span> <span class="token string">&quot;<span class="token variable">$DAYS_VALID</span>&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-passin</span> pass:<span class="token string">&quot;<span class="token variable">$PASSWORD</span>&quot;</span> <span class="token parameter variable">-passout</span> pass:<span class="token string">&quot;<span class="token variable">$PASSWORD</span>&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-subj</span> <span class="token string">&quot;/C=CN/ST=yourcity/L=yourprovince/O=yourcompany/CN=yourdept&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;3. 导入CA文件到truststore......&quot;</span>
keytool <span class="token parameter variable">-keystore</span> <span class="token string">&quot;<span class="token variable">$TRUST_STORE</span>&quot;</span> <span class="token parameter variable">-alias</span> CARoot <span class="token punctuation">\\</span>
<span class="token parameter variable">-import</span> <span class="token parameter variable">-file</span> <span class="token string">&quot;<span class="token variable">$CERT_AUTH_FILE</span>&quot;</span> <span class="token parameter variable">-storepass</span> <span class="token string">&quot;<span class="token variable">$TRUST_STORE_PASSWORD</span>&quot;</span> <span class="token parameter variable">-keypass</span> <span class="token string">&quot;<span class="token variable">$TRUST_KEY_PASS</span>&quot;</span> <span class="token parameter variable">-noprompt</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;4. 从key store中导出集群证书......&quot;</span>
keytool <span class="token parameter variable">-keystore</span> <span class="token string">&quot;<span class="token variable">$KEY_STORE</span>&quot;</span> <span class="token parameter variable">-alias</span> <span class="token string">&quot;<span class="token variable">$CLUSTER_NAME</span>&quot;</span> <span class="token parameter variable">-certreq</span> <span class="token parameter variable">-file</span> <span class="token string">&quot;<span class="token variable">$CLUSTER_CERT_FILE</span>&quot;</span> <span class="token parameter variable">-storepass</span> <span class="token string">&quot;<span class="token variable">$STORE_PASSWORD</span>&quot;</span> <span class="token parameter variable">-keypass</span> <span class="token string">&quot;<span class="token variable">$KEY_PASSWORD</span>&quot;</span> <span class="token parameter variable">-noprompt</span>


<span class="token builtin class-name">echo</span> <span class="token string">&quot;5. 签发证书......&quot;</span>
openssl x509 <span class="token parameter variable">-req</span> <span class="token parameter variable">-CA</span> <span class="token string">&quot;<span class="token variable">$CERT_AUTH_FILE</span>&quot;</span> <span class="token parameter variable">-CAkey</span> <span class="token variable">$CERT_OUTPUT_PATH</span>/ca-key <span class="token parameter variable">-in</span> <span class="token string">&quot;<span class="token variable">$CLUSTER_CERT_FILE</span>&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-out</span> <span class="token string">&quot;<span class="token variable">\${CLUSTER_CERT_FILE}</span>-signed&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-days</span> <span class="token string">&quot;<span class="token variable">$DAYS_VALID</span>&quot;</span> <span class="token parameter variable">-CAcreateserial</span> <span class="token parameter variable">-passin</span> pass:<span class="token string">&quot;<span class="token variable">$PASSWORD</span>&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;6. 导入CA文件到keystore......&quot;</span>
keytool <span class="token parameter variable">-keystore</span> <span class="token string">&quot;<span class="token variable">$KEY_STORE</span>&quot;</span> <span class="token parameter variable">-alias</span> CARoot <span class="token parameter variable">-import</span> <span class="token parameter variable">-file</span> <span class="token string">&quot;<span class="token variable">$CERT_AUTH_FILE</span>&quot;</span> <span class="token parameter variable">-storepass</span> <span class="token string">&quot;<span class="token variable">$STORE_PASSWORD</span>&quot;</span> <span class="token punctuation">\\</span>
 <span class="token parameter variable">-keypass</span> <span class="token string">&quot;<span class="token variable">$KEY_PASSWORD</span>&quot;</span> <span class="token parameter variable">-noprompt</span>
 
<span class="token builtin class-name">echo</span> <span class="token string">&quot;7. 导入已签发证书到keystore......&quot;</span>
keytool <span class="token parameter variable">-keystore</span> <span class="token string">&quot;<span class="token variable">$KEY_STORE</span>&quot;</span> <span class="token parameter variable">-alias</span> <span class="token string">&quot;<span class="token variable">\${CLUSTER_NAME}</span>&quot;</span> <span class="token parameter variable">-import</span> <span class="token parameter variable">-file</span> <span class="token string">&quot;<span class="token variable">\${CLUSTER_CERT_FILE}</span>-signed&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-storepass</span> <span class="token string">&quot;<span class="token variable">$STORE_PASSWORD</span>&quot;</span> <span class="token parameter variable">-keypass</span> <span class="token string">&quot;<span class="token variable">$KEY_PASSWORD</span>&quot;</span> <span class="token parameter variable">-noprompt</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),l=[p];function o(r,i){return s(),n("div",null,l)}const k=a(t,[["render",o],["__file","SSL.html.vue"]]);export{k as default};
